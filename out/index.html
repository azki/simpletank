<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko">
	<head>
		<meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
		<title>Simple Tank : tank.azki.org</title>
		<style type="text/css">
			html,body {margin:0}
		</style>
		<script type="text/javascript" src="./js/jquery-1.4.1.min.js"></script>
<!--[if IE]>
		<script type="text/javascript" src="./js/excanvas.compiled.js"></script>
<![endif]-->
		<script type="text/javascript">
var simpleTank = {};
		</script>
		<script type="text/javascript" src="./js/map.js"></script>
		<script type="text/javascript" src="./js/tanks.js"></script>
		<script type="text/javascript" src="./js/tank.js"></script>
		<script type="text/javascript" src="./js/shot.js"></script>
		
		<script type="text/javascript" src="./js/player.js"></script>
		<script type="text/javascript" src="./js/Ai04.js"></script>
		<script type="text/javascript" src="./js/ui.js"></script>
		<script type="text/javascript">
/*global $, setTimeout, simpleTank*/
"use strict";
$(function () {
	var mapWidth, mapHeight, i, cvmap, cvtank, cvshot, mapCtx, tankCtx, shotCtx, map, tanks, shot, player, ui;
	mapWidth = innerWidth;
	mapHeight = innerHeight;
	$("#canvasPanel").width(mapWidth).height(mapHeight);
	$("#canvasPanel>canvas").attr("width", mapWidth).attr("height", mapHeight);
	for (i = -1; -90 < i; i -= 1) {
		$("#angleValue").append("<option value=\"" + i + "\">" + i + "</option>");
	}
	for (i = 90; 0 < i; i -= 1) {
		$("#angleValue").append("<option value=\"" + i + "\">" + i + "</option>");
	}
	for (i = 0; i < 100; i += 1) {
		$("#powerValue").append("<option value=\"" + i + "\">" + i + "</option>");
	}
	cvmap = $("#cvmap").get(0);
	cvtank = $("#cvtank").get(0);
	cvshot = $("#cvshot").get(0);
	if (cvmap.getContext) {
		mapCtx = cvmap.getContext("2d");
		tankCtx = cvtank.getContext("2d");
		shotCtx = cvshot.getContext("2d");
		map = new simpleTank.Map(mapCtx, {
			width: mapWidth,
			height: mapHeight
		});
		tanks = new simpleTank.Tanks(tankCtx, {
			map: map
		});
		shot = new simpleTank.Shot(shotCtx, {
			map: map,
			tanks: tanks
		});
		
		map.newMapData();
		map.redraw();
		//TODO. start up.
		//ui.newGame(player);
		//ui.startPlayer();
		player = new simpleTank.Player([{
			type: "user",
			color: "#f00",
			name: "유저1",
			team: 1
		}, {
			type: "Ai04",
			difficulty: 5,
			color: "#00f",
			name: "컴퓨터1",
			team: 2
		}, {
			type: "user",
			color: "#ff0",
			name: "유저2",
			team: 3
		}, {
			type: "Ai04",
			difficulty: 10,
			color: "#f0f",
			name: "컴퓨터2",
			team: 4
		}]);
		ui = new simpleTank.Ui(map, tanks, shot, player, function (result) {
			if (result.type === "turnLost") {
				setTimeout(function () {
					map.newMapData();
					map.redraw();
					ui.newGame(player);
					ui.startPlayer();
				}, 3000);
			}
		});
		ui.startPlayer();
	}
	else {
		$("#canvasPanel").html("<h1>Canvas를 지원하지 않는 브라우저입니다.</h1>");
	}
});
		</script>
	</head>
	<body>
		<div id="canvasPanel" style="position:absolute;">
			<canvas id="cvmap" style="position:absolute;"></canvas>
			<canvas id="cvtank" style="position:absolute;"></canvas>
			<canvas id="cvshot" style="position:absolute;"></canvas>
		</div>
		<div style="display:none;">
			<select id="angleValue" class="inputText"></select>
			<select id="powerValue" class="inputText"></select>
		</div>
	</body>
</html>